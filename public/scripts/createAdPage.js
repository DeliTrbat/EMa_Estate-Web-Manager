class AddressMap{static changeCenter(lon,lat){AddressMap.view.setCenter(ol.proj.fromLonLat([lon,lat])),AddressMap.marker.setGeometry(new ol.geom.Point(ol.proj.fromLonLat([lon,lat]))),AddressMap.coordinates={lat:lat,lon:lon}}static searchAddress(address){""===address||AddressMap.searchingNow||(AddressMap.searchingNow=!0,AddressMap.lastSearch=address,fetch("https://nominatim.openstreetmap.org?format=json&limit=1&q="+address).then(response=>response.json()).then(data=>{var lon;null!=data[0]&&({lat:data,lon}=data[0],null!=data&&null!=lon&&AddressMap.changeCenter(lon,data)),setTimeout(()=>AddressMap.searchingNow=!1,3e3)}).catch(__reason=>AddressMap.coordinates=null))}static init(){navigator.geolocation.getCurrentPosition(pos=>{AddressMap.changeCenter(pos.coords.longitude,pos.coords.latitude)}),AddressMap.map.on("click",event=>{const[lon,lat]=ol.proj.toLonLat(event.coordinate);event=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=`+lon;fetch(event).then(response=>response.json()).then(data=>{data=data.display_name;null!=data&&(AddressMap.lastSearch=data,AddressMap.marker.setGeometry(new ol.geom.Point(ol.proj.fromLonLat([lon,lat]))),CreateAd.addressElement.value=data)}).catch(__reason=>AddressMap.coordinates=null)})}}var _a;AddressMap.coordinates=null,AddressMap.view=new ol.View({center:ol.proj.fromLonLat([27.568014,47.178197]),zoom:17}),AddressMap.marker=new ol.Feature({}),AddressMap.searchingNow=!1,AddressMap.lastSearch=null,AddressMap.map=new ol.Map({target:"map",layers:[new ol.layer.Tile({source:new ol.source.OSM}),new ol.layer.Vector({source:new ol.source.Vector({features:[AddressMap.marker]}),style:new ol.style.Style({image:new ol.style.Icon({anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:"https://openlayers.org/en/latest/examples/data/icon.png"})})})],view:AddressMap.view});class CreateAd{}(_a=CreateAd).addressElement=document.getElementsByName("ADDRESS")[0],CreateAd.uploadedFiles=[],CreateAd.dropdownOptions={apType:DropdownFilterOption.createWithDefault(["Decomandat","Semidecomandat","Nedecomandat","Circular","Open-Space"],"Alege tipul apartamentului"),type:DropdownFilterOption.createWithDefault(["Apartament","Casă","Office","Teren"],"Alege tipul proprietății"),transaction:DropdownFilterOption.createWithDefault(["Închiriere","Vânzare"],"Alege tipul anunțului")},CreateAd.dropdownMapToString={apType:["","detached","semi-detached","non-detached","circular","open-space"],type:["","apartment","house","office","land"],transaction:["","rent","sell"]},CreateAd.addImage=(alt,url)=>{const el=document.createElement("img");el.src=url,el.alt=alt,CreateAd.imagesElement.append(el)},CreateAd.addImageHandler=event=>{var files=event.target.files;if(CreateAd.imageError){const labelElement=createSimpleElement("label","label images__add-img image-container clickable"),iconPlusElement=createSimpleElement("span","icon icon-plus");iconPlusElement.id="icon-plus",labelElement.append(iconPlusElement,CreateAd.addImageInputElement),CreateAd.imagesElement.innerHTML="",CreateAd.imagesElement.appendChild(labelElement)}for(let i=0;i<files.length;++i){var file=files[i],imgURL=URL.createObjectURL(file);if(_a.uploadedFiles.push(file),CreateAd.addImage(file.name,imgURL),10===_a.uploadedFiles.length)return void(_a.addImageInputElement.parentElement.style.display="none")}},CreateAd.formDataHandler=event=>{event.formData.delete("images"),CreateAd.uploadedFiles.forEach((file,index)=>event.formData.set("image"+index,file));const type=CreateAd.dropdownOptions.type.getOption();event.formData.set("TYPE",type.index.toString()),1==type.index&&event.formData.set("AP_TYPE",CreateAd.dropdownOptions.apType.getOption().index.toString()),event.formData.set("TRANSACTION_TYPE",CreateAd.dropdownOptions.transaction.getOption().index.toString()),null!=AddressMap.coordinates&&(event.formData.set("LAT",AddressMap.coordinates.lat.toString()),event.formData.set("LON",AddressMap.coordinates.lon.toString()))};const disableElement=el=>{el.style.display="none","FIELDSET"===el.tagName&&el.setAttribute("disabled","")},enableElement=el=>{el.style.removeProperty("display"),"FIELDSET"===el.tagName&&el.removeAttribute("disabled")};DocumentHandler.whenReady(()=>{var residentialSpecific=document.getElementById("residential-specific"),houseSpecific=document.getElementById("house-specific"),buildingSpecific=document.getElementById("building-specific");const dropDownContainer=document.getElementById("dropdown-container"),typeLinked=[[],[residentialSpecific,buildingSpecific,CreateAd.dropdownOptions.apType.element],[buildingSpecific,houseSpecific],[buildingSpecific],[]];typeLinked.forEach(list=>list.forEach(disableElement));let lastIndex=0;CreateAd.dropdownOptions.type.onChange((index,__text)=>{typeLinked[lastIndex].forEach(disableElement),typeLinked[index].forEach(enableElement),lastIndex=index}),Object.values(CreateAd.dropdownOptions).forEach(op=>FilterOptionHandler.add(op)),dropDownContainer.append(CreateAd.dropdownOptions.type.element,CreateAd.dropdownOptions.apType.element,CreateAd.dropdownOptions.transaction.element),CreateAd.addImageInputElement=document.getElementById("add-image-input"),CreateAd.imagesElement=document.getElementById("images"),CreateAd.addImageInputElement.addEventListener("change",CreateAd.addImageHandler,!0),CreateAd.imageError=document.getElementById("image-error");const formElement=document.getElementsByTagName("form")[0];formElement.addEventListener("formdata",CreateAd.formDataHandler)}),DocumentHandler.whenReady(()=>{AddressMap.init();const addressElement=CreateAd["addressElement"];addressElement.oninput=()=>AddressMap.searchAddress(addressElement.value),setInterval(()=>{var currentAddress=addressElement.value;currentAddress!=AddressMap.lastSearch&&AddressMap.searchAddress(currentAddress)},1e3)});